<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AssTroll XD chart broker</title>
    <link rel="icon" type="image/x-icon" href="deku.ico">
    <!-- Preload common fonts to speed up first paint -->
    <link rel="preload" href="Fonts/Inter.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="Fonts/MaterialSymbolsRounded[FILL,GRAD,opsz,wght].ttf" as="font" type="font/ttf"
        crossorigin>
    <link rel="preload" href="Fonts/ChironGoRoundTC-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="Fonts/GoogleSansCode-Medium.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="Fonts/SUSE-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin>
    <script src="./Js/main.js" type="module"></script>
    <script src="./Js/localStorage.js" type="module"></script>
    <script type="module">
        import { settings, play } from './Js/main.js';
        window.settings = settings;
        window.play = play;

        import { setLocale } from './Js/i18n.js';
        window.setLocale = setLocale;
        const saved = localStorage.getItem('locale') || navigator.language || 'zh-TW';
        console.log(localStorage.getItem('locale'));
        setLocale(saved);
    </script>
    <link rel="stylesheet" href="Styles/main.css">
    <script>
        // Register service worker to cache fonts and assets for faster repeat loads
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('./sw.js').then(function (reg) {
                    console.log('Service worker registered.', reg.scope);
                }).catch(function (err) {
                    console.warn('Service worker registration failed:', err);
                });
            });
        }
    </script>
</head>
<script>
    let masterExample = ``;
    /*
    ||test using
    (180){16}
    1,2,3,4,5,6,7,8,
    12,23,34,45,56,67,78,81,
    1x,2x,3x,4x,5x,6x,7x,8x,
    1b,2b,3b,4b,5b,6b,7b,8b,
    1$,2$,3$,4$,5$,6$,7$,8$,
    A1,A2,A3,A4,A5,A6,A7,A8,
    B1,B2,B3,B4,B5,B6,B7,B8,
    D1,D2,D3,D4,D5,D6,D7,D8,
    E1,E2,E3,E4,E5,E6,E7,E8,
    C,
    1b^2^3^4^5^6^7^8^1[2:1],
    1>2>3<4<5<6<7>8>1[2:1]b,,,,,,,,,,,,
    1bp2p3p4p5p6p7p8p1[2:1],,,,,,,,,,,,
    1q2q3q4q5q6q7q8q1[2:1]b,,,,,,,,,,,,
    1bpp2pp3pp4pp5pp6pp7pp8pp1[2:1],,,,,,,,,,,,
    1qq2qq3qq4qq5qq6qq7qq8qq1[2:1]b,,,,,,,,,,,,
    1h[4:1],,,,2h[4:1],,,,3h[4:1],,,,4h[4:1],,,,
    5h[4:1],,,,6h[4:1],,,,7h[4:1],,,,8h[4:1],,,,
    */
</script>

<body>
    <!-- Loading overlay: shows current download action and optional progress -->
    <div id="loading-overlay" class="hide">
        <div class="loading-box">
            <div id="loading-message">載入中...</div>
            <div id="loading-progress" class="loading-progress" aria-hidden="true">
                <div class="loading-progress-bar" style="width:0%"></div>
            </div>
        </div>
    </div>
    <div class="icons-container">
        <div id="fullscreen">
            <span class="icon-minimize">fullscreen</span>
        </div>
        <div id="lockProgress">
            <span class="icon-minimize">lock_open_right</span>
            <span class="icon-maximize" style="display: none;">lock</span>
        </div>
        <div id="-0.25xSpeed">
            <span class="icon-minimize">fast_rewind</span>
        </div>
        <div id="1xSpeed">
            <span class="hide-on-hover" id="nowSpeed">bruh</span>
            <span class="show-on-hover">1x_mobiledata</span>
        </div>
        <div id="+0.25xSpeed">
            <span class="icon-minimize">fast_forward</span>
        </div>
        <div id="hideContorls">
            <span class="icon-minimize">open_in_full</span>
            <span class="icon-maximize" style="display: none;">hide</span>
        </div>
    </div>
    <div class="preview-control">
        <div id="zoomIn">+</div>
        <div id="zoomOut">-</div>
    </div>
    <img src="" alt="background Image" id="bgImg" onerror="this.style.display='none'">
    <video src="" id="backgroundVideo" muted></video>
    <div id="bgMask"></div>
    <canvas id="render" oncontextmenu="return false;"></canvas>
    <canvas id="audioRender"></canvas>
    <textarea id="editor" placeholder="-- No context, please type simai here or load maidata"></textarea>
    <div id="customMenu" class="hide">
        <div class="menu-item" data-action="cut" data-i18n="cut">剪下</div>
        <div class="menu-item" data-action="copy" data-i18n="copy">複製</div>
        <div class="menu-item" data-action="paste" data-i18n="paste">貼上</div>
        <div class="menu-item" data-action="selectAll" data-i18n="selectAll">全選</div>
        <div class="menu-item" data-action="trun-upside-down" data-i18n="mirror-upside-down">↕ 上下反轉</div>
        <div class="menu-item" data-action="trun-left-right" data-i18n="mirror-left-right">↔ 左右反轉</div>
        <div class="menu-item" data-action="trun-right" data-i18n="turn-right">↻ 右轉 45° (順時針)</div>
        <div class="menu-item" data-action="trun-left" data-i18n="turn-left">↺ 左轉 45° (逆時針)</div>
        <div class="menu-item" data-action="trun-180" data-i18n="turn-180">⇌ 180° 轉</div>
        <div class="menu-item" data-action="ad-rm-bk" data-i18n="add-remove-break">加入/移除 break (滑星不適用)</div>
        <div class="menu-item" data-action="ad-rm-ex" data-i18n="add-remove-ex">加入/移除 ex (滑星不適用)</div>
        <!--<div class="menu-item has-submenu">更多選項
            <div class="submenu">
                <div class="menu-item" data-action="export-pdf">匯出 PDF</div>
                <div class="menu-item" data-action="export-maidata">匯出 Maidata</div>
                <div class="menu-item" data-action="import-settings">匯入設定</div>
            </div>
        </div>-->
    </div>
    <audio id="bgm" crossorigin="anonymous"></audio>
    <div class="controls">
        <div class="time-display">
            <div id="nowDiff">Difficulty: MASTER</div>
            <span id="nowTrackTime">0:00.00 / 0:00.00</span>
        </div>
        <div class="controls-btns">
            <div id="stopBtn"></div>
            <div id="playBtn"></div>
            <div id="back10Btn"></div>
            <div id="back5Btn"></div>
            <div id="fast5Btn"></div>
            <div id="fast10Btn"></div>
        </div>
        <input type="range" id="timeline" value="0.0" min="0" max="8" step="0.01">
    </div>
    <div class="actions">
        <div class="menu-trigger-button" data-target=".file-menu"><span data-i18n="file-menu">檔案</span></div>
        <div class="menu-trigger-button" data-target=".edit-menu"><span data-i18n="edit-menu">編輯</span></div>
        <div class="menu-trigger-button" data-target=".diff-menu"><span data-i18n="diff-menu">難度</span></div>
        <div class="info-menu-button"><span data-i18n="info-menu">譜面資訊</span></div>
        <!-- <div class="record-button"><span data-i18n="record-button">錄製</span></div>-->
        <div class="sett-menu-button"><span data-i18n="sett-menu">設定</span></div>
        <div class="help-menu-button"><span data-i18n="help-menu">幫助</span></div>
    </div>
    <div class="dropdownlist">
        <ul class="file-menu dropdown-content hide">
            <li data-action="new-file"    data-i18n="new-file">新建空白</li>
            <li data-action="open-folder" data-i18n="open-folder">開啟資料夾</li>
            <li data-action="open-maidata" data-i18n="open-maidata">開啟 Maidata</li>
            <li data-action="open-audio"   data-i18n="open-audio">開啟音檔</li>
            <li data-action="download-offline" data-i18n="download-offline">下載離線資源</li>
            <li data-action="save-file"        data-i18n="save-file">儲存</li>
        </ul>
        <ul class="diff-menu dropdown-content hide">
            <li data-diff="1">EASY</li>
            <li data-diff="2">BASIC</li>
            <li data-diff="3">ADVANCED</li>
            <li data-diff="4">EXPERT</li>
            <li data-diff="5">MASTER</li>
            <li data-diff="6">RE:MASTER</li>
            <li data-diff="7">ORIGINAL</li>
        </ul>
        <ul class="edit-menu dropdown-content hide">
            <li data-action="undo" data-i18n="undo">↩ 復原</li>
            <li data-action="redo" data-i18n="redo">↪ 重做</li>
        </ul>
    </div>

    <div id="settings-overlay" class="hide"></div>
    <div id="settings-popup" class="hide">
        <form id="settings-form"></form>
        <button type="button" id="save-settings-btn" data-i18n="save">儲存</button>
        <button type="button" id="reset-settings-btn" data-i18n="reset-settings">重置設定</button>
        <button type="button" id="clear-cache-btn" data-i18n="clear-cache">清除快取</button>
        <button type="button" id="cancel-settings-btn" data-i18n="cancel">取消</button>
    </div>

    <div id="info-popup" class="hide">
        <form id="info-form"></form>
        <button type="button" id="save-info-btn" data-i18n="save">儲存</button>
        <button type="button" id="cancel-info-btn" data-i18n="cancel">取消</button>
    </div>

    <div id="imgs" class="imgs"></div>
</body>

</html>